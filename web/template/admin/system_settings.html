{{template "base" .}} {{define "content"}}
<div class="space-y-8" x-data="systemSettingsForm()" x-init="init()" x-cloak>
    <nav
        class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80"
    >
        <div
            class="flex flex-wrap gap-2"
            role="tablist"
            aria-label="{{tr .language "System settings navigation" "系统设置导航"}}"
        >
            <template x-for="tab in tabs" :key="tab.id">
                <button
                    type="button"
                    class="inline-flex items-center rounded-xl border px-4 py-2 text-sm font-medium transition-colors"
                    :class="
                        activeTab === tab.id
                            ? 'border-blue-500 bg-blue-50 text-blue-700 shadow-sm dark:border-blue-400/60 dark:bg-blue-500/10 dark:text-blue-200'
                            : 'border-transparent bg-slate-100 text-slate-600 hover:border-slate-200 hover:bg-white dark:bg-slate-900/60 dark:text-slate-300 dark:hover:border-slate-700 dark:hover:bg-slate-900'
                    "
                    @click="setTab(tab.id)"
                    role="tab"
                    :id="`tab-${tab.id}`"
                    :aria-selected="activeTab === tab.id"
                    :aria-controls="tab.id"
                >
                    <span x-text="tab.label"></span>
                </button>
            </template>
        </div>
    </nav>
    <section
        id="basic"
        role="tabpanel"
        aria-labelledby="tab-basic"
        x-show="activeTab === 'basic'"
        x-transition
        class="space-y-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80"
    >
        <header class="space-y-1">
            <h2
                class="text-lg font-semibold text-slate-900 dark:text-slate-100"
            >
                {{tr .language "Basic information" "基础信息"}}
            </h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">
                {{tr .language "Site name and logo appear in public and admin navigation." "站点名称与 Logo 将出现在前台和后台导航。"}}
            </p>
        </header>
        <div class="grid grid-cols-1 gap-6">
            <div class="space-y-2">
                <div class="flex items-center justify-between gap-2">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-200"
                        >{{tr .language "Site name" "站点名称"}}<span class="ml-1 text-rose-500">*</span></span
                    >
                    <span class="text-xs text-slate-400 dark:text-slate-500"
                        >{{tr .language "Configure both languages" "分别配置中英文"}}</span
                    >
                </div>
                <div class="grid gap-4 sm:grid-cols-2">
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "Chinese" "中文"}}</span
                        >
                        <input
                            type="text"
                            x-model="form.siteNameZh"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "e.g. CommitLog" "例如：CommitLog"}}"
                        />
                    </label>
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "English" "英文"}}</span
                        >
                        <input
                            type="text"
                            x-model="form.siteNameEn"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "e.g. CommitLog" "e.g. CommitLog"}}"
                        />
                    </label>
                </div>
                <span class="text-xs text-slate-500 dark:text-slate-400"
                    >{{tr .language "Used in browser titles and navigation." "用于浏览器标题、前后台导航等位置。"}}</span
                >
            </div>
            <div class="space-y-2">
                <div class="flex items-center justify-between gap-2">
                    <span class="text-sm font-medium text-slate-700 dark:text-slate-200"
                        >{{tr .language "Site description" "站点描述"}}<span class="ml-1 text-rose-500">*</span></span
                    >
                    <span class="text-xs text-slate-400 dark:text-slate-500"
                        >{{tr .language "Configure both languages" "分别配置中英文"}}</span
                    >
                </div>
                <div class="grid gap-4 sm:grid-cols-2">
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "Chinese" "中文"}}</span
                        >
                        <textarea
                            x-model="form.siteDescriptionZh"
                            rows="3"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "Briefly describe the blog focus and value (80-160 chars)." "简要介绍博客定位与价值主张，建议 80-160 字。"}}"
                        ></textarea>
                    </label>
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "English" "英文"}}</span
                        >
                        <textarea
                            x-model="form.siteDescriptionEn"
                            rows="3"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "Briefly describe the blog focus and value (80-160 chars)." "Briefly describe the blog focus and value (80-160 chars)."}}"
                        ></textarea>
                    </label>
                </div>
                <span class="text-xs text-slate-500 dark:text-slate-400"
                    >{{tr .language "Used as default SEO and social summary when page-specific copy is missing." "搜索引擎摘要与社交分享默认文案，会出现在未填写专属描述的页面。"}}</span
                >
            </div>
            <label class="flex flex-col gap-2">
                <span
                    class="text-sm font-medium text-slate-700 dark:text-slate-200"
                    >{{tr .language "Preferred language" "首选语言"}}</span
                >
                <select
                    x-model="form.preferredLanguage"
                    class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                >
                    <option value="zh">{{tr .language "Chinese" "中文"}}（Chinese）</option>
                    <option value="en">English</option>
                </select>
                <span class="text-xs text-slate-500 dark:text-slate-400"
                    >{{tr .language "Sets the default site language and overrides region/browser detection (visitors can switch manually)." "保存后将作为站点默认语言，覆盖地区/浏览器识别（访客可手动切换）。"}}</span
                >
            </label>
            <div class="space-y-2">
                <span
                    class="text-sm font-medium text-slate-700 dark:text-slate-200"
                    >{{tr .language "Default social image" "默认分享图"}}</span
                >
                <div class="flex items-center gap-4">
                    <div
                        class="flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-dashed border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900/60"
                    >
                        <template x-if="form.siteSocialImage">
                            <img
                                :src="form.siteSocialImage"
                                alt="{{tr .language "Social image preview" "分享图预览"}}"
                                class="h-full w-full object-cover"
                                @error="form.siteSocialImage = ''"
                            />
                        </template>
                        <template x-if="!form.siteSocialImage">
                            <span
                                class="text-xs font-medium text-slate-400 dark:text-slate-500"
                                >{{tr .language "No image" "暂无图片"}}</span
                            >
                        </template>
                    </div>
                    <div
                        class="max-w-sm space-y-1 text-xs leading-relaxed text-slate-500 dark:text-slate-400"
                    >
                        <p>
                            {{tr .language "Used when posts have no cover. Recommended size: 1200×630px." "文章未设置封面时用于社交媒体与消息卡片展示，建议尺寸 1200×630px。"}}
                        </p>
                        <p
                            x-show="form.siteSocialImage"
                            x-text="form.siteSocialImage"
                            class="truncate text-[11px] text-slate-400 dark:text-slate-500"
                            x-cloak
                        ></p>
                    </div>
                </div>
                <input
                    type="url"
                    x-model="form.siteSocialImage"
                    class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                    placeholder="https://example.com/og.png"
                />
                <span class="text-xs text-slate-500 dark:text-slate-400"
                    >{{tr .language "Paste a URL or use an uploaded image link." "可直接粘贴网络地址或后台上传的图片链接。"}}</span
                >
            </div>
            <div class="space-y-6">
                <div class="flex flex-col gap-2">
                    <span
                        class="inline-flex items-center gap-1 text-sm font-medium text-slate-700 dark:text-slate-200"
                        >{{tr .language "Site logo" "站点 Logo"}}<span class="text-rose-500">*</span></span
                    >
                    <p class="text-xs text-slate-500 dark:text-slate-400">
                        {{tr .language "Upload logos for light and dark modes. Transparent PNG or SVG is recommended." "请分别上传适用于浅色与深色模式的 Logo，建议使用透明背景 PNG 或 SVG。"}}
                    </p>
                </div>
                <div class="grid gap-6 md:grid-cols-2">
                    <div class="flex flex-col gap-3">
                        <span
                            class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400"
                            >{{tr .language "Light mode" "浅色模式"}}</span
                        >
                        <div
                            class="rounded-2xl border border-dashed border-slate-200 p-4 transition-colors dark:border-slate-700/80"
                        >
                            <div class="flex items-center gap-4">
                                <div
                                    class="relative flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-slate-200 bg-slate-50 shadow-sm dark:border-slate-700 dark:bg-slate-900/60"
                                >
                                    <template x-if="form.siteLogoUrlLight">
                                        <img
                                            :src="form.siteLogoUrlLight"
                                            alt="{{tr .language "Light logo preview" "浅色 Logo 预览"}}"
                                            class="h-full w-full object-cover"
                                            @error="form.siteLogoUrlLight = ''"
                                        />
                                    </template>
                                    <template x-if="!form.siteLogoUrlLight">
                                        <span
                                            class="text-xs font-medium text-slate-400 dark:text-slate-500"
                                            >{{tr .language "No logo" "暂无 Logo"}}</span
                                        >
                                    </template>
                                </div>
                                <div
                                    class="max-w-xs space-y-1 text-xs leading-relaxed text-slate-500 dark:text-slate-400"
                                >
                                    <p>
                                        {{tr .language "Displayed in navigation for light mode." "浅色模式下用于前台与后台导航的品牌展示。"}}
                                    </p>
                                    <p
                                        x-show="form.siteLogoUrlLight"
                                        x-text="form.siteLogoUrlLight"
                                        class="truncate text-[11px] text-slate-400 dark:text-slate-500"
                                        x-cloak
                                    ></p>
                                </div>
                            </div>
                            <div class="mt-4 flex flex-wrap items-center gap-2">
                                <input
                                    type="file"
                                    accept="image/*"
                                    class="hidden"
                                    x-ref="logoInputLight"
                                    @change="handleLogoSelected($event, 'light')"
                                />
                                <button
                                    type="button"
                                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition-colors hover:border-blue-200 hover:text-blue-600 dark:border-slate-700 dark:text-slate-300 dark:hover:border-blue-400/50 dark:hover:text-blue-200"
                                    @click="triggerLogoUpload('light')"
                                    :disabled="logoUploadingLight"
                                >
                                    <span x-show="!logoUploadingLight"
                                        >{{tr .language "Upload image" "上传图片"}}</span
                                    >
                                    <span x-show="logoUploadingLight"
                                        >{{tr .language "Uploading..." "上传中..."}}</span
                                    >
                                </button>
                                <button
                                    type="button"
                                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-500 transition-colors hover:border-rose-200 hover:text-rose-600 dark:border-slate-700 dark:text-slate-400 dark:hover:border-rose-500/40 dark:hover:text-rose-300"
                                    @click="clearLogo('light')"
                                    x-show="form.siteLogoUrlLight"
                                    x-cloak
                                >
                                    {{tr .language "Remove logo" "移除 Logo"}}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-3">
                        <span
                            class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400"
                            >{{tr .language "Dark mode" "深色模式"}}</span
                        >
                        <div
                            class="rounded-2xl border border-dashed border-slate-200 p-4 transition-colors dark:border-slate-700/80"
                        >
                            <div class="flex items-center gap-4">
                                <div
                                    class="relative flex h-20 w-20 items-center justify-center overflow-hidden rounded-2xl border border-slate-200 bg-slate-900 shadow-sm dark:border-slate-700 dark:bg-slate-900/40"
                                >
                                    <template x-if="form.siteLogoUrlDark">
                                        <img
                                            :src="form.siteLogoUrlDark"
                                            alt="{{tr .language "Dark logo preview" "深色 Logo 预览"}}"
                                            class="h-full w-full object-cover"
                                            @error="form.siteLogoUrlDark = ''"
                                        />
                                    </template>
                                    <template x-if="!form.siteLogoUrlDark">
                                        <span
                                            class="text-xs font-medium text-slate-400 dark:text-slate-500"
                                            >{{tr .language "No logo" "暂无 Logo"}}</span
                                        >
                                    </template>
                                </div>
                                <div
                                    class="max-w-xs space-y-1 text-xs leading-relaxed text-slate-500 dark:text-slate-400"
                                >
                                    <p>
                                        {{tr .language "Logo for dark mode; consider higher contrast." "深色模式下用于品牌展示的图标，可适当提升亮度对比。"}}
                                    </p>
                                    <p
                                        x-show="form.siteLogoUrlDark"
                                        x-text="form.siteLogoUrlDark"
                                        class="truncate text-[11px] text-slate-400 dark:text-slate-500"
                                        x-cloak
                                    ></p>
                                </div>
                            </div>
                            <div class="mt-4 flex flex-wrap items-center gap-2">
                                <input
                                    type="file"
                                    accept="image/*"
                                    class="hidden"
                                    x-ref="logoInputDark"
                                    @change="handleLogoSelected($event, 'dark')"
                                />
                                <button
                                    type="button"
                                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition-colors hover:border-blue-200 hover:text-blue-600 dark:border-slate-700 dark:text-slate-300 dark:hover:border-blue-400/50 dark:hover:text-blue-200"
                                    @click="triggerLogoUpload('dark')"
                                    :disabled="logoUploadingDark"
                                >
                                    <span x-show="!logoUploadingDark"
                                        >{{tr .language "Upload image" "上传图片"}}</span
                                    >
                                    <span x-show="logoUploadingDark"
                                        >{{tr .language "Uploading..." "上传中..."}}</span
                                    >
                                </button>
                                <button
                                    type="button"
                                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-500 transition-colors hover:border-rose-200 hover:text-rose-600 dark:border-slate-700 dark:text-slate-400 dark:hover:border-rose-500/40 dark:hover:text-rose-300"
                                    @click="clearLogo('dark')"
                                    x-show="form.siteLogoUrlDark"
                                    x-cloak
                                >
                                    {{tr .language "Remove logo" "移除 Logo"}}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="space-y-4">
                        <div class="space-y-2">
                            <span class="text-sm font-medium text-slate-700 dark:text-slate-200"
                                >{{tr .language "Admin footer" "后台页脚文案"}}</span
                            >
                            <div class="grid gap-4 sm:grid-cols-2">
                                <label class="flex flex-col gap-2">
                                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                                        >{{tr .language "Chinese" "中文"}}</span
                                    >
                                    <input
                                        type="text"
                                        x-model="form.adminFooterTextZh"
                                        class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                        placeholder="{{tr .language "e.g. Daily progress, lasting impact" "例如：日拱一卒，功不唐捐"}}"
                                    />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                                        >{{tr .language "English" "英文"}}</span
                                    >
                                    <input
                                        type="text"
                                        x-model="form.adminFooterTextEn"
                                        class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                        placeholder="{{tr .language "e.g. Grow a little every day" "e.g. Grow a little every day"}}"
                                    />
                                </label>
                            </div>
                            <span class="text-xs text-slate-500 dark:text-slate-400"
                                >{{tr .language "Shown in the admin footer." "展示于后台页面底部。"}}</span
                            >
                        </div>

                        <div class="space-y-2">
                            <span class="text-sm font-medium text-slate-700 dark:text-slate-200"
                                >{{tr .language "Public footer" "前台页脚文案"}}</span
                            >
                            <div class="grid gap-4 sm:grid-cols-2">
                                <label class="flex flex-col gap-2">
                                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                                        >{{tr .language "Chinese" "中文"}}</span
                                    >
                                    <input
                                        type="text"
                                        x-model="form.publicFooterTextZh"
                                        class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                        placeholder="{{tr .language "e.g. Create with purpose" "例如：激发创造，延迟满足"}}"
                                    />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                                        >{{tr .language "English" "英文"}}</span
                                    >
                                    <input
                                        type="text"
                                        x-model="form.publicFooterTextEn"
                                        class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                        placeholder="{{tr .language "e.g. Create with purpose" "e.g. Create with purpose"}}"
                                    />
                                </label>
                            </div>
                            <span class="text-xs text-slate-500 dark:text-slate-400"
                                >{{tr .language "Shown in the public footer for slogans or copyright." "展示于前台页脚，可用于呈现品牌口号或版权信息。"}}</span
                            >
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section
        id="gallery"
        role="tabpanel"
        aria-labelledby="tab-gallery"
        x-show="activeTab === 'gallery'"
        x-transition
        class="space-y-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80"
    >
        <header class="space-y-1">
            <h2
                class="text-lg font-semibold text-slate-900 dark:text-slate-100"
            >
                {{tr .language "Gallery settings" "摄影集设置"}}
            </h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">
                {{tr .language "Manage gallery display info and public nav visibility." "管理摄影集展示信息与前台入口开关。"}}
            </p>
        </header>
        <div class="space-y-6">
            <div class="space-y-2">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-200"
                    >{{tr .language "Gallery subtitle" "摄影集副标题"}}</span
                >
                <div class="grid gap-4 sm:grid-cols-2">
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "Chinese" "中文"}}</span
                        >
                        <input
                            type="text"
                            x-model="form.gallerySubtitleZh"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "e.g. Shot by Lumix S5M2 / OnePlus 13" "例如：Shot by Lumix S5M2 / OnePlus 13"}}"
                        />
                    </label>
                    <label class="flex flex-col gap-2">
                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300"
                            >{{tr .language "English" "英文"}}</span
                        >
                        <input
                            type="text"
                            x-model="form.gallerySubtitleEn"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "e.g. Shot by Lumix S5M2 / OnePlus 13" "e.g. Shot by Lumix S5M2 / OnePlus 13"}}"
                        />
                    </label>
                </div>
                <span class="text-xs text-slate-500 dark:text-slate-400"
                    >{{tr .language "Shown under the Gallery page title." "展示在摄影集页面标题下方。"}}</span
                >
            </div>
            <div
                class="space-y-3 rounded-xl border border-slate-200 bg-slate-50/70 p-4 dark:border-slate-800 dark:bg-slate-900/60"
            >
                <div class="flex items-start justify-between gap-4">
                    <div class="space-y-1">
                        <p
                            class="text-sm font-medium text-slate-700 dark:text-slate-200"
                        >
                            {{tr .language "Enable Gallery" "启用摄影集"}}
                        </p>
                        <p class="text-xs text-slate-500 dark:text-slate-400">
                            {{tr .language "Shows Gallery in public navigation." "开启后前台导航显示摄影集入口。"}}
                        </p>
                    </div>
                    <label
                        class="relative inline-flex cursor-pointer items-center"
                    >
                        <input
                            type="checkbox"
                            class="sr-only peer"
                            x-model="form.galleryEnabled"
                        />
                        <span
                            class="h-6 w-11 rounded-full bg-slate-200 transition peer-checked:bg-blue-600 dark:bg-slate-700 dark:peer-checked:bg-blue-500"
                        ></span>
                        <span
                            class="absolute left-1 top-1 h-4 w-4 rounded-full bg-white shadow transition peer-checked:translate-x-5"
                        ></span>
                    </label>
                </div>
            </div>
        </div>
    </section>

    <section
        id="contacts"
        role="tabpanel"
        aria-labelledby="tab-contacts"
        x-show="activeTab === 'contacts'"
        x-transition
        class="space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80"
    >
        {{template "admin_contact_manager" .}}
    </section>

    <section
        id="ai"
        role="tabpanel"
        aria-labelledby="tab-ai"
        x-show="activeTab === 'ai'"
        x-transition
        class="space-y-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80"
    >
        <header class="space-y-1">
            <h2
                class="text-lg font-semibold text-slate-900 dark:text-slate-100"
            >
                {{tr .language "AI service integration" "AI 服务集成"}}
            </h2>
            <p class="text-sm text-slate-500 dark:text-slate-400">
                {{tr .language "Choose a model provider for summaries and manage API keys. Test connectivity here." "选择用于自动摘要等能力的模型平台，并维护对应的 API Key，可在此处快速测试连通性。"}}
            </p>
        </header>
        <div class="flex flex-col gap-4 lg:flex-row lg:items-start">
            <div class="flex-1 space-y-4">
                <label class="flex flex-col gap-2">
                    <span
                        class="text-sm font-medium text-slate-700 dark:text-slate-200"
                        >{{tr .language "AI provider" "当前 AI 平台"}}<span class="ml-1 text-rose-500"
                            >*</span
                        ></span
                    >
                    <select
                        x-model="form.aiProvider"
                        class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                    >
                        <option value="openai">OpenAI</option>
                        <option value="deepseek">DeepSeek</option>
                    </select>
                    <span class="text-xs text-slate-500 dark:text-slate-400"
                        >{{tr .language "Requests will use the selected provider. Make sure the API key is valid." "系统会按照所选平台调用对应接口，请确保 API Key 有效且额度充足。"}}</span
                    >
                </label>
                <div class="space-y-3">
                    <div
                        x-show="form.aiProvider === 'openai'"
                        x-cloak
                        class="space-y-2"
                    >
                        <label class="flex flex-col gap-2">
                            <span
                                class="text-sm font-medium text-slate-700 dark:text-slate-200"
                                >{{tr .language "OpenAI API Key" "OpenAI API Key"}}</span
                            >
                            <div class="flex items-center gap-2">
                                <input
                                    :type="showApiKey ? 'text' : 'password'"
                                    x-model="form.openaiApiKey"
                                    class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                    placeholder="sk-..."
                                    autocomplete="off"
                                />
                                <button
                                    type="button"
                                    @click="showApiKey = !showApiKey"
                                    class="whitespace-nowrap rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition-colors hover:border-blue-200 hover:text-blue-600 dark:border-slate-700 dark:text-slate-300 dark:hover:border-blue-400/50 dark:hover:text-blue-200"
                                >
                                    <span
                                        x-text="showApiKey ? {{toJSON (tr .language "Hide" "隐藏")}} : {{toJSON (tr .language "Show" "显示")}}"
                                    ></span>
                                </button>
                            </div>
                            <span
                                class="text-xs text-slate-500 dark:text-slate-400"
                                >{{tr .language "Copy from OpenAI console; it is stored securely." "从 OpenAI 控制台复制 Key，系统将以密文方式保存。"}}</span
                            >
                        </label>
                    </div>
                    <div
                        x-show="form.aiProvider === 'deepseek'"
                        x-cloak
                        class="space-y-2"
                    >
                        <label class="flex flex-col gap-2">
                            <span
                                class="text-sm font-medium text-slate-700 dark:text-slate-200"
                                >{{tr .language "DeepSeek API Key" "DeepSeek API Key"}}</span
                            >
                            <div class="flex items-center gap-2">
                                <input
                                    :type="showDeepSeekKey ? 'text' : 'password'"
                                    x-model="form.deepseekApiKey"
                                    class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                                    placeholder="sk-..."
                                    autocomplete="off"
                                />
                                <button
                                    type="button"
                                    @click="showDeepSeekKey = !showDeepSeekKey"
                                    class="whitespace-nowrap rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition-colors hover:border-blue-200 hover:text-blue-600 dark:border-slate-700 dark:text-slate-300 dark:hover:border-blue-400/50 dark:hover:text-blue-200"
                                >
                                    <span
                                        x-text="showDeepSeekKey ? {{toJSON (tr .language "Hide" "隐藏")}} : {{toJSON (tr .language "Show" "显示")}}"
                                    ></span>
                                </button>
                            </div>
                            <span
                                class="text-xs text-slate-500 dark:text-slate-400"
                                >{{tr .language "Use the DeepSeek platform key with proper access." "请填写从 DeepSeek 开放平台获取的 Key，确保具备调用权限。"}}</span
                            >
                        </label>
                    </div>
                </div>
                <div class="space-y-4 pt-2">
                    <label class="flex flex-col gap-2">
                        <span
                            class="text-sm font-medium text-slate-700 dark:text-slate-200"
                            >{{tr .language "AI summary system prompt" "AI 摘要系统提示"}}</span
                        >
                        <textarea
                            x-model="form.aiSummaryPrompt"
                            rows="4"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "System prompt for summaries; leave blank for default." "用于生成文章摘要的系统提示语，留空将使用默认值。"}}"
                        ></textarea>
                        <span class="text-xs text-slate-500 dark:text-slate-400"
                            >{{tr .language "Describe style, length, and constraints to refine outputs." "建议描述摘要风格、字数范围与注意事项，便于快速调整生成效果。"}}</span
                        >
                    </label>
                    <label class="flex flex-col gap-2">
                        <span
                            class="text-sm font-medium text-slate-700 dark:text-slate-200"
                            >{{tr .language "AI rewrite system prompt" "AI 全文优化系统提示"}}</span
                        >
                        <textarea
                            x-model="form.aiRewritePrompt"
                            rows="5"
                            class="w-full rounded-xl border border-slate-200 px-4 py-2.5 text-sm text-slate-900 transition-colors focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-100 dark:focus:border-blue-400 dark:focus:ring-blue-500/20"
                            placeholder="{{tr .language "System prompt for rewriting; leave blank for default." "用于润色全文的系统提示语，留空将使用默认值。"}}"
                        ></textarea>
                        <span class="text-xs text-slate-500 dark:text-slate-400"
                            >{{tr .language "Define structure, tone, and constraints to guide Markdown output." "可明确结构、语气与保留内容等要求，帮助模型输出更贴合预期的 Markdown 文稿。"}}</span
                        >
                    </label>
                </div>
            </div>
            <div class="flex gap-2 pt-1 lg:pt-6">
                <button
                    type="button"
                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition-colors hover:border-blue-200 hover:text-blue-600 dark:border-slate-700 dark:text-slate-300 dark:hover:border-blue-400/50 dark:hover:text-blue-200"
                    @click="testAI()"
                    :disabled="aiTesting"
                >
                    <span
                        x-show="!aiTesting"
                        x-text="`{{tr .language "Test" "测试"}}${providerMeta().label}{{tr .language " connectivity" "连通性"}}`"
                    ></span>
                    <span x-show="aiTesting">{{tr .language "Testing..." "测试中..."}}</span>
                </button>
                <button
                    type="button"
                    class="rounded-lg border border-slate-200 px-3 py-2 text-xs font-medium text-slate-500 transition-colors hover:border-rose-200 hover:text-rose-600 dark:border-slate-700 dark:text-slate-400 dark:hover:border-rose-500/40 dark:hover:text-rose-300"
                    @click="clearCurrentAPIKey()"
                    x-show="currentApiKey()"
                    x-cloak
                >
                    {{tr .language "Clear" "清空"}}
                </button>
            </div>
        </div>
    </section>

    <section
        class="flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors dark:border-slate-800 dark:bg-slate-900/80 sm:flex-row sm:items-center sm:justify-between"
    >
        <div class="space-y-1">
            <h2
                class="text-sm font-semibold text-slate-900 dark:text-slate-100"
            >
                {{tr .language "Save settings" "保存设置"}}
            </h2>
            <p class="text-xs text-slate-500 dark:text-slate-400">
                {{tr .language "Write the current form values to the database." "点击按钮将当前表单内容写入数据库。"}}
            </p>
        </div>
        <button
            type="button"
            @click="submit()"
            :disabled="loading"
            class="inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-slate-300 dark:hover:bg-blue-500/90 dark:disabled:bg-slate-700/80"
        >
            <span x-show="!loading">{{tr .language "Save settings" "保存设置"}}</span>
            <span x-show="loading">{{tr .language "Saving..." "保存中..."}}</span>
        </button>
    </section>
</div>

<script src="/static/js/system_settings_tabs.js"></script>
<script>
    function systemSettingsForm() {
        const preferServerMessage = {{if eq .language "zh"}}true{{else}}false{{end}};
        const i18n = {
            tabBasic: {{toJSON (tr .language "Basic information" "基础信息")}},
            tabGallery: {{toJSON (tr .language "Gallery" "摄影集")}},
            tabContacts: {{toJSON (tr .language "Contacts" "联系方式")}},
            tabAI: {{toJSON (tr .language "AI services" "AI 服务")}},
            loadSettingsFailed: {{toJSON (tr .language "Failed to load system settings" "加载系统设置失败")}},
            selectImageFile: {{toJSON (tr .language "Please select an image file" "请选择图片文件")}},
            logoUploadFailed: {{toJSON (tr .language "Logo upload failed. Please try again." "Logo 上传失败，请稍后重试")}},
            logoUploadSuccess: {{toJSON (tr .language "Logo uploaded" "Logo 上传成功")}},
            apiKeyMissingPrefix: {{toJSON (tr .language "Please enter" "请先填写")}},
            apiTestFailed: {{toJSON (tr .language "Test failed. Please try again." "测试失败，请稍后重试")}},
            apiTestSuccessSuffix: {{toJSON (tr .language " connection is OK" " 接口连接正常")}},
            siteNameRequired: {{toJSON (tr .language "Please enter site name" "请填写站点名称")}},
            siteDescriptionRequired: {{toJSON (tr .language "Please enter site description" "请填写站点描述")}},
            lightLogoRequired: {{toJSON (tr .language "Please upload light logo" "请上传浅色模式 Logo")}},
            darkLogoRequired: {{toJSON (tr .language "Please upload dark logo" "请上传深色模式 Logo")}},
            settingsSaved: {{toJSON (tr .language "Settings saved" "系统设置已保存")}},
            saveFailed: {{toJSON (tr .language "Save failed. Please try again." "保存失败，请稍后重试")}},
        };
	        return {
	            loading: false,
	            showApiKey: false,
	            showDeepSeekKey: false,
	            aiTesting: false,
            tabs: [
                { id: "basic", label: i18n.tabBasic },
                { id: "gallery", label: i18n.tabGallery },
                { id: "contacts", label: i18n.tabContacts },
                { id: "ai", label: i18n.tabAI },
            ],
	            activeTab: "basic",
	            form: {
	                siteName: "",
	                siteNameZh: "",
	                siteNameEn: "",
	                siteLogoUrl: "",
	                siteLogoUrlLight: "",
	                siteLogoUrlDark: "",
	                siteDescription: "",
	                siteDescriptionZh: "",
	                siteDescriptionEn: "",
	                siteSocialImage: "",
	                preferredLanguage: "zh",
	                adminFooterText: "",
	                adminFooterTextZh: "",
	                adminFooterTextEn: "",
	                publicFooterText: "",
	                publicFooterTextZh: "",
	                publicFooterTextEn: "",
	                gallerySubtitle: "",
	                gallerySubtitleZh: "",
	                gallerySubtitleEn: "",
	                galleryEnabled: true,
	                aiProvider: "openai",
	                openaiApiKey: "",
	                deepseekApiKey: "",
	                aiSummaryPrompt: "",
                aiRewritePrompt: "",
            },
            logoUploadingLight: false,
            logoUploadingDark: false,
            init() {
                this.fetchSettings();
                this.syncTabFromHash();
                window.addEventListener("hashchange", () =>
                    this.syncTabFromHash(),
                );
            },
            tabIds() {
                return this.tabs.map((tab) => tab.id);
            },
            syncTabFromHash() {
                const helper = window.SystemSettingsTabs;
                const tabIds = this.tabIds();
                if (helper && typeof helper.normalizeTabId === "function") {
                    this.activeTab = helper.normalizeTabId(
                        window.location.hash,
                        tabIds,
                        tabIds[0],
                    );
                    return;
                }
                const raw = String(window.location.hash || "")
                    .replace(/^#/, "")
                    .trim();
                if (raw && tabIds.includes(raw)) {
                    this.activeTab = raw;
                    return;
                }
                this.activeTab = tabIds[0];
            },
            setTab(id) {
                if (!id) {
                    return;
                }
                this.activeTab = id;
                const hash = `#${id}`;
                if (window.location.hash === hash) {
                    return;
                }
                if (window.history && window.history.replaceState) {
                    window.history.replaceState(null, "", hash);
                    return;
                }
                window.location.hash = hash;
            },
            fetchSettings() {
                fetch("/admin/api/system/settings")
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.error) {
                            const message = preferServerMessage
                                ? data.error
                                : i18n.loadSettingsFailed;
                            window.AdminUI.toast({
                                message,
                                type: "error",
                            });
                            return;
                        }
                        if (data.settings) {
                            this.form = Object.assign(this.form, data.settings);
                            this.applyLogoFallbacks();
                            this.normalizeProvider();
                        }
                    })
                    .catch(() => {
                        window.AdminUI.toast({
                            message: i18n.loadSettingsFailed,
                            type: "error",
                        });
                    });
            },
            normalizeProvider() {
                const provider = (this.form.aiProvider || "").toLowerCase();
                if (provider === "deepseek") {
                    this.form.aiProvider = "deepseek";
                } else {
                    this.form.aiProvider = "openai";
                }
            },
            applyLogoFallbacks() {
                const light = this.form.siteLogoUrlLight?.trim() || "";
                const dark = this.form.siteLogoUrlDark?.trim() || "";
                const legacy = this.form.siteLogoUrl?.trim() || "";
                if (!light && legacy) {
                    this.form.siteLogoUrlLight = legacy;
                }
                if (!this.form.siteLogoUrlDark?.trim()) {
                    this.form.siteLogoUrlDark =
                        this.form.siteLogoUrlLight ||
                        legacy ||
                        this.form.siteLogoUrlDark;
                }
                if (!this.form.siteLogoUrlLight?.trim()) {
                    this.form.siteLogoUrlLight =
                        this.form.siteLogoUrlDark || legacy;
                }
                this.form.siteLogoUrl =
                    this.form.siteLogoUrlLight ||
                    this.form.siteLogoUrlDark ||
                    "";
            },
            triggerLogoUpload(mode) {
                const flag =
                    mode === "dark"
                        ? "logoUploadingDark"
                        : "logoUploadingLight";
                const refName =
                    mode === "dark" ? "logoInputDark" : "logoInputLight";
                if (this[flag]) {
                    return;
                }
                const input = this.$refs[refName];
                if (input) {
                    input.click();
                }
            },
            handleLogoSelected(event, mode) {
                const files = event?.target?.files;
                if (!files || files.length === 0) {
                    return;
                }
                const [file] = files;
                event.target.value = "";
                if (!file || !file.type.startsWith("image/")) {
                    window.AdminUI.toast({
                        message: i18n.selectImageFile,
                        type: "warning",
                    });
                    return;
                }
                this.uploadLogo(file, mode);
            },
            async uploadLogo(file, mode) {
                const flag =
                    mode === "dark"
                        ? "logoUploadingDark"
                        : "logoUploadingLight";
                this[flag] = true;
                const formData = new FormData();
                formData.append("image", file);
                try {
                    const response = await fetch("/admin/api/upload/image", {
                        method: "POST",
                        body: formData,
                    });
                    const data = await response.json().catch(() => ({}));
                    if (
                        !response.ok ||
                        data.error ||
                        !data.data ||
                        !data.data.url
                    ) {
                        const message =
                            preferServerMessage && data && (data.error || data.message)
                                ? data.error || data.message
                                : i18n.logoUploadFailed;
                        window.AdminUI.toast({ message, type: "error" });
                        return;
                    }
                    if (mode === "dark") {
                        this.form.siteLogoUrlDark = data.data.url;
                    } else {
                        this.form.siteLogoUrlLight = data.data.url;
                        this.form.siteLogoUrl = data.data.url;
                    }
                    this.applyLogoFallbacks();
                    window.AdminUI.toast({
                        message: i18n.logoUploadSuccess,
                        type: "success",
                    });
                } catch (error) {
                    const message =
                        preferServerMessage && error && error.message
                            ? error.message
                            : i18n.logoUploadFailed;
                    window.AdminUI.toast({ message, type: "error" });
                } finally {
                    this[flag] = false;
                }
            },
            clearLogo(mode) {
                if (mode === "dark") {
                    this.form.siteLogoUrlDark = "";
                } else {
                    this.form.siteLogoUrlLight = "";
                    this.form.siteLogoUrl = "";
                }
                this.applyLogoFallbacks();
            },
            providerMeta() {
                const mapping = {
                    openai: { label: "OpenAI", keyField: "openaiApiKey" },
                    deepseek: { label: "DeepSeek", keyField: "deepseekApiKey" },
                };
                const provider = (this.form.aiProvider || "").toLowerCase();
                return mapping[provider] || mapping.openai;
            },
            currentApiKey() {
                const meta = this.providerMeta();
                const key = this.form[meta.keyField] || "";
                return key.trim();
            },
            clearCurrentAPIKey() {
                const meta = this.providerMeta();
                this.form[meta.keyField] = "";
            },
            async testAI() {
                this.normalizeProvider();
                const meta = this.providerMeta();
                const provider = (
                    this.form.aiProvider || "openai"
                ).toLowerCase();
                const apiKey = this.currentApiKey();
                if (!apiKey) {
                    window.AdminUI.toast({
                        message: `${i18n.apiKeyMissingPrefix} ${meta.label} API Key`,
                        type: "warning",
                    });
                    return;
                }
                this.aiTesting = true;
                try {
                    const response = await fetch(
                        "/admin/api/system/settings/ai/test",
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ provider, apiKey }),
                        },
                    );
                    const data = await response.json().catch(() => ({}));
                    if (!response.ok || data.error) {
                        const message =
                            preferServerMessage && data && data.error
                                ? data.error
                                : i18n.apiTestFailed;
                        window.AdminUI.toast({ message, type: "error" });
                        return;
                    }
                    window.AdminUI.toast({
                        message:
                            preferServerMessage && data.message
                                ? data.message
                                : `${meta.label}${i18n.apiTestSuccessSuffix}`,
                        type: "success",
                    });
                } catch (error) {
                    const message =
                        preferServerMessage && error && error.message
                            ? error.message
                            : i18n.apiTestFailed;
                    window.AdminUI.toast({ message, type: "error" });
                } finally {
                    this.aiTesting = false;
                }
            },
	            submit() {
	                if (!this.form.siteNameZh.trim() && !this.form.siteNameEn.trim() && !this.form.siteName.trim()) {
	                    window.AdminUI.toast({
	                        message: i18n.siteNameRequired,
	                        type: "warning",
	                    });
	                    return;
	                }
                if (
                    !this.form.siteDescriptionZh.trim() &&
                    !this.form.siteDescriptionEn.trim() &&
                    !this.form.siteDescription.trim()
                ) {
                    window.AdminUI.toast({
                        message: i18n.siteDescriptionRequired,
                        type: "warning",
                    });
                    return;
                }
                this.applyLogoFallbacks();
                if (!this.form.siteLogoUrlLight?.trim()) {
                    window.AdminUI.toast({
                        message: i18n.lightLogoRequired,
                        type: "warning",
                    });
                    return;
                }
                if (!this.form.siteLogoUrlDark?.trim()) {
                    window.AdminUI.toast({
                        message: i18n.darkLogoRequired,
                        type: "warning",
                    });
                    return;
                }
                this.normalizeProvider();
                this.loading = true;
	                fetch("/admin/api/system/settings", {
	                    method: "PUT",
	                    headers: { "Content-Type": "application/json" },
	                    body: JSON.stringify({
	                        siteName: this.form.siteNameZh || this.form.siteNameEn || this.form.siteName,
	                        siteNameZh: this.form.siteNameZh,
	                        siteNameEn: this.form.siteNameEn,
	                        siteLogoUrl: this.form.siteLogoUrlLight,
	                        siteLogoUrlLight: this.form.siteLogoUrlLight,
	                        siteLogoUrlDark: this.form.siteLogoUrlDark,
	                        siteDescription: this.form.siteDescriptionZh || this.form.siteDescriptionEn || this.form.siteDescription,
	                        siteDescriptionZh: this.form.siteDescriptionZh,
	                        siteDescriptionEn: this.form.siteDescriptionEn,
	                        siteSocialImage: this.form.siteSocialImage,
	                        preferredLanguage: this.form.preferredLanguage,
	                        adminFooterText:
	                            this.form.adminFooterTextZh ||
	                            this.form.adminFooterTextEn ||
	                            this.form.adminFooterText,
	                        adminFooterTextZh: this.form.adminFooterTextZh,
	                        adminFooterTextEn: this.form.adminFooterTextEn,
	                        publicFooterText:
	                            this.form.publicFooterTextZh ||
	                            this.form.publicFooterTextEn ||
	                            this.form.publicFooterText,
	                        publicFooterTextZh: this.form.publicFooterTextZh,
	                        publicFooterTextEn: this.form.publicFooterTextEn,
	                        gallerySubtitle:
	                            this.form.gallerySubtitleZh ||
	                            this.form.gallerySubtitleEn ||
	                            this.form.gallerySubtitle,
	                        gallerySubtitleZh: this.form.gallerySubtitleZh,
	                        gallerySubtitleEn: this.form.gallerySubtitleEn,
	                        galleryEnabled: this.form.galleryEnabled,
	                        aiProvider: this.form.aiProvider,
	                        openaiApiKey: this.form.openaiApiKey,
	                        deepseekApiKey: this.form.deepseekApiKey,
                        aiSummaryPrompt: this.form.aiSummaryPrompt,
                        aiRewritePrompt: this.form.aiRewritePrompt,
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.error) {
                            const message = preferServerMessage
                                ? data.error
                                : i18n.saveFailed;
                            window.AdminUI.toast({
                                message,
                                type: "error",
                            });
                            return;
                        }
                        if (data.settings) {
                            this.form = Object.assign(this.form, data.settings);
                            this.applyLogoFallbacks();
                            this.normalizeProvider();
                        }
                        window.AdminUI.toast({
                            message:
                                preferServerMessage && data.message
                                    ? data.message
                                    : i18n.settingsSaved,
                            type: "success",
                        });
                    })
                    .catch(() => {
                        window.AdminUI.toast({
                            message: i18n.saveFailed,
                            type: "error",
                        });
                    })
                    .finally(() => {
                        this.loading = false;
                    });
            },
        };
    }
</script>
{{end}}
