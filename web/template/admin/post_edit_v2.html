{{template "base" .}}

{{define "content"}}
{{$content := ""}}
{{if .post}}
        {{if .post.Content}}
                {{$content = .post.Content}}
        {{end}}
{{end}}
{{$initial := dict "content" $content "post" .post "latestPublication" .latestPublication}}

<style>
	body.milkdown-immersive {
		background-color: var(--crepe-color-background, #ffffff);
	}

	body.milkdown-immersive header,
	body.milkdown-immersive footer {
		display: none !important;
	}

	body.milkdown-immersive main {
		max-width: 100vw !important;
		width: 100vw !important;
		padding: 0 !important;
		min-height: 100vh;
	}

        body.milkdown-immersive main > * {
                margin: 0;
                min-height: 100vh;
        }

        .milkdown-immersive-shell {
                display: flex;
                flex-direction: column;
                height: 100%;
        }

        .milkdown-immersive-wrapper {
                flex: 1 1 auto;
                display: flex;
        }

        .milkdown-immersive-shell .milkdown {
                flex: 1 1 auto;
                min-height: 0;
                --crepe-color-background: #ffffff;
                background-color: #ffffff;
        }
</style>

<div class="milkdown-immersive-shell">
        <div
                class="milkdown-immersive-wrapper mx-8 pt-24 pb-10 md:mx-24 md:pb-24 lg:mx-40 xl:mx-80 2xl:mx-auto 2xl:max-w-4xl w-full"
        >
                <div id="milkdown-app" class="milkdown"></div>
        </div>
</div>

<script>
window.__MILKDOWN_V2__ = {{$initial | toJSON}};
document.body.classList.add('milkdown-immersive');
const milkdownCleanup = () => {
        document.body.classList.remove('milkdown-immersive');
        const controller = window.MilkdownV2?.controller;
        if (controller && typeof controller.dispose === 'function') {
                try {
                        controller.dispose();
                } catch (error) {
                        console.error('[milkdown] 清理控制器失败', error);
                }
        }
        const crepe = window.MilkdownV2?.crepe;
        if (crepe && typeof crepe.destroy === 'function') {
                void crepe.destroy();
        }
};
window.addEventListener('pagehide', milkdownCleanup, { once: true });
window.addEventListener('beforeunload', milkdownCleanup, { once: true });
</script>
<script type="module" src="/static/dist/assets/milkdown_v2.js"></script>
{{end}}
