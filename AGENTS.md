# Repository Guidelines

构建一个「代码清晰易读、好维护、美观、优雅」的博客站点需要从架构、代码、设计与协作四个维度同频推进。本指南总结团队最佳实践，落地时务必遵循。

## 愿景与设计哲学
- **清晰**：任何新成员在 30 分钟内应能理解目录结构和主要依赖。保持简洁命名，去除重复逻辑。
- **可靠**：所有改动默认携带最小必要测试或验证步骤，保证线上体验稳定。
- **优雅**：界面和交互遵守“对比、重复、对齐、亲密性”四项设计原则，持续优化细节，减少视觉噪音。
- **可演进**：模块职责单一，便于替换和扩展；避免引入与现有栈冲突的新技术。

## 架构总览
- `cmd/server/main.go` 是唯一启动入口，负责初始化数据库、路由、配置等依赖。这里禁止添加业务逻辑。
- `internal/db`、`internal/handler`、`internal/router`、`internal/service` 分别承载数据模型、HTTP 入口、路由编排与业务服务。新增私有包请放在 `internal` 下保持封装。
- 模板位于 `web/template/{layout,admin}`，建议在同名目录维护配套的 Alpine.js 片段；Tailwind 源文件为 `web/static/css/input.css`，编译输出 `web/static/css/output.css`。
- 运维与产品文档集中在 `document/*.md`；演示数据统一由 `scripts/generate_test_data.go` 生成，禁止手动修改 SQLite。

## 后端开发准则
- Handler 负责输入校验与响应组装；业务规则隔离在 service，数据访问交给 db 层。
- 通过接口隔离第三方依赖，单元测试使用 mock 或内存实现覆盖关键路径。
- 迁移脚本、批处理放在 `scripts/` 或独立包，避免散落在业务目录。
- 提交前运行 `gofmt` 或 `goimports`；包名使用 lower_snake_case，结构体与接口使用 PascalCase。

## 前端开发准则
- 模板命名与 Handler、Service 保持一致，便于追溯来源。共享组件拆入 `components`，减少重复。
- Tailwind 类名按“布局 → 组件 → 状态”排序，`output.css` 只读。新增组件前先复用或扩展现有样式。
- Alpine.js 状态逻辑精简，保持响应式与声明式的平衡；HTMX 请求命名语义化，显式处理加载/出错状态。
- 视觉设计遵循四项原则：对比强调信息层级，重复统一风格，对齐保证秩序，亲密性用于分组相关内容。

## 构建与运行
- `make run`：以生产配置在 `:8082` 启动服务，用于构建验收。
- `make dev`：调试模式启动，启用 Gin Debug、模板热加载与丰富日志。
- `npm run build:css`：单次编译 Tailwind；`npm run watch:css`：监听源文件，适合样式联调。
- `go run scripts/generate_test_data.go`：刷新演示数据，确保后台筛选、搜索等功能可验证。

## 测试与质量保障
- 在实现旁创建 `*_test.go` 文件，优先采用表驱动测试，提交前执行 `make test`。
- 前端改动需记录手工验证步骤，覆盖富文本、上传、HTMX 流程等关键场景。
- 引入新字段或数据结构时同步更新演示数据脚本与界面展示，保证端到端一致。
- 发生回归必须补齐自动化测试或脚本，确保缺陷不再出现。

## 提交与评审流程
- 提交信息遵循 Conventional Commits（例如 `feat(upload): ...`、`fix(router): ...`），作用域建议对应修改包或模板目录。
- PR 描述需包含：修改意图、关联需求或 Issue、验证命令、涉及 UI 变化的前后对比截图/录屏。
- 评审优先关注行为变更、潜在回归、测试覆盖与代码可读性；合并前确认 CI 与本地验证均通过。

## 技术栈守则
- 服务端：Golang + Gin + GORM + SQLite，优先复用既有封装与中间件。
- 前端：HTMX + Tailwind CSS + Alpine.js，如需引入新依赖，需在文档说明动机与取舍并提前评估影响。

## 日常维护
- 定期回顾本指南，确保文档、示例与实际实现保持同步。
- 新成员入组第一天需通读本指南，理解团队约定。
- 发现指南与实践不一致时，优先更新指南或修复代码，保持规则鲜活。

遵循以上约定，团队即可持续交付兼具工程质量与视觉体验的博客产品。欢迎在实践中沉淀新的经验，再次迭代本指南。
